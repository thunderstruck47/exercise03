{% import "bootstrap/utils.html" as utils %}
{% import "bootstrap/wtf.html" as wtf %}
{% extends "base.html" %}
{% block title %}Order{% endblock %}
{% block body %}
<div class="content-section">
  <br/>
    {{ utils.flashed_messages() }}
  <br/>
  <h1 style="text-align:center;">Create Order</h1>
  <hr class="intro-divider">
  <br/>
  <div class="row">  
    <div class="col-lg-6 col-md-12 col-sm-12">
      <h4>Details</h4>
      <br/>
      {{ wtf.quick_form(form) }}
    </div>
    <div class="col-lg-6 col-md-12 col-sm-12">
      <h4>Products</h4>
        {% if products %}
        </br>
        <table class="table table-responsive">
          <thead>
            <tr>
              <th width="25%"> Image </th>
              <th width="25%"> Name </th>
              <th width="25%"> Quantity </th>
              <th width="25%"> Price </th>
            </tr>
          </thead>
          <tbody>
            {% for product in products %}
            <tr>
              <td><img src="{{ url_for('static', filename='uploads/' + product.main_image) if product.main_image }}" style="max-width:100%" alt="{{ product.name }} Main Image"></td>
              <td>{{ product.name }}</td>
              <td>{{ product.quantity }}</td>
              <td>{{ product.price }}&#x20AC;</td>  
            </tr>
            {% endfor %}
            <tr>
              <td></td>
              <td></td>
              <td>Subtotal:</td>
              <td>{{ total }}&#x20AC;</td>
           </tr>
         </tbody>
       </table>
     {% else %}
       <div style="text-align: center">
         <h4> You have no products to order. </h4>
         <hr class="intro-divider">
       </div>
     {% endif %} 
     </br>
     <script src="https://www.paypalobjects.com/api/checkout.js"></script>
     <div id="paypal-button-container" style="width:100%;"></div>
    </div>
  </div>
</div>
<script>
    // Render the PayPal button
    paypal.Button.render({
        // Set your environment
        env: 'sandbox', // sandbox | production
        // Specify the style of the button
        style: {
            label: 'pay', // checkout | credit | pay
            size:  'responsive',    // small | medium | responsive
            shape: 'rect',     // pill | rect
            color: 'blue'      // gold | blue | silver
        },
        client: {
            sandbox:    'AZDxjDScFpQtjWTOUtWKbyN_bDt4OgqaF4eYXlewfBP4-8aqX3PiV8e1GWU6liB2CUXlkA59kJXE7M6R',
            production: '<insert production client id>'
        },
        payment: function(data, actions) {
            return actions.payment.create({
                transactions: [
                    {
                            amount: { total: '{{total}}', currency: 'EUR' }
                    }
                ]
            });
        },
        onAuthorize: function(data, actions) {
            return actions.payment.execute().then(function() {
                window.alert('Payment Complete!');
            });
        }
    }, '#paypal-button-container');
</script>

{% endblock %}
